<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">

<title>alinantico</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>

body{
  font-family: Arial;
  background:#f3f3f3;
  padding:20px;
}

h1{
  text-align:center;
}

.box{
  background:white;
  padding:20px;
  margin:15px 0;
  border-radius:10px;
  box-shadow:0 0 5px #ccc;
}

.stats{
  display:flex;
  justify-content:space-around;
}

.stat{
  font-size:22px;
  font-weight:bold;
}

</style>
</head>

<body>

<h1>ðŸ“Š alinantico</h1>

<div class="box">
<input type="file" id="fileInput">
</div>

<div class="box stats">

<div>
Totale<br>
<span id="totale" class="stat">0 â‚¬</span>
</div>

<div>
Media<br>
<span id="media" class="stat">0 â‚¬</span>
</div>

<div>
Vendite<br>
<span id="numero" class="stat">0</span>
</div>

</div>

<div class="box">
<h3>Canali di vendita</h3>
<canvas id="canali"></canvas>
</div>

<div class="box">
<h3>Tipologie</h3>
<canvas id="tipi"></canvas>
</div>

<div class="box">
<h3>Vendite mensili</h3>
<canvas id="mesi"></canvas>
</div>

<script>

let g1,g2,g3;

document.getElementById("fileInput").addEventListener("change",caricaFile);

function caricaFile(e){

const file=e.target.files[0];
const reader=new FileReader();

reader.onload=function(x){

const data=new Uint8Array(x.target.result);
const wb=XLSX.read(data,{type:"array"});
const sh=wb.Sheets[wb.SheetNames[0]];
const json=XLSX.utils.sheet_to_json(sh);

analizza(json);

};

reader.readAsArrayBuffer(file);
}

function analizza(dati){

let totale=0;
let count=0;

let canali={};
let tipi={};
let mesi={};

dati.forEach(r=>{

let prezzo=Number(r["prezzo di vendita"]);
if(!prezzo)return;

totale+=prezzo;
count++;

let c=r["luogo di vendita"];
let t=r["TIPOLOGIA"];
let m=r["Mese di vendita"];

if(c)canali[c]=(canali[c]||0)+prezzo;
if(t)tipi[t]=(tipi[t]||0)+prezzo;
if(m)mesi[m]=(mesi[m]||0)+prezzo;

});

document.getElementById("totale").innerText=totale.toFixed(2)+" â‚¬";
document.getElementById("media").innerText=(totale/count).toFixed(2)+" â‚¬";
document.getElementById("numero").innerText=count;

creaGrafico("canali",canali,"bar",g1);
creaGrafico("tipi",tipi,"pie",g2);
creaGrafico("mesi",mesi,"line",g3);

}

function creaGrafico(id,data,tipo,old){

if(old)old.destroy();

return new Chart(
document.getElementById(id),
{
type:tipo,
data:{
labels:Object.keys(data),
datasets:[{
data:Object.values(data)
}]
}
});
}

</script>

</body>
</html>
